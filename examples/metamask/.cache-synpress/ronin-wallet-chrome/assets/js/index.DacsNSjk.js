import{b as s,M as l,L as c,B as d}from"./foregroundCache.BJs-C-d6.js";import{R as r}from"./index.DkvvEwj1.js";import{i}from"./index.umd.bNrpW4vQ.js";import"./ethers.CrVDN1GO.js";import"./lodash.BduLK7P_.js";import"./bip39.Q3JWhqge.js";import"./@ledgerhq/hw-transport-webhid.D8NNKifb.js";const p=()=>{if(typeof document>"u")return;let t;const o=document.getElementsByTagName("link");for(let e=0;e<o.length;e++){const n=o[e].getAttribute("rel");n&&["icon","shortcut icon"].includes(n)&&(t=o[e].getAttribute("href")||void 0)}if(t)try{return new URL(t).href}catch{return`${document.location.origin}/${t.replace("/","")}`}},E=()=>{var e;const t=p(),o=(e=document.querySelector("meta[property='og:site_name']"))==null?void 0:e.getAttribute("content");return{url:document.location.origin,name:o||document.title,icon:t}};window.addEventListener(i.RequestType.JSON_RPC,async t=>{const o=t.detail,e=o.payload.id;try{const n=E(),a=await s.runtime.sendMessage({type:l.ASK_PROVIDER_FROM_CONTENT_SCRIPT,message:{...o.payload},peerMeta:n});window.postMessage(JSON.stringify(a),window.location.origin)}catch(n){c.error("JSON_RPC",n);const a={isWalletEvent:!0,type:i.WalletEventType.JSON_RPC_RESPONSE,data:{jsonrpc:"2.0",error:n,id:e,result:void 0}};window.postMessage(JSON.stringify(a),window.location.origin)}},!1);s.runtime.onMessage.addListener((t,o)=>{if(s.runtime.id!==o.id)return console.error(`Receiving message from unauthorized sender ${o}.`),Promise.reject();switch(t.roninEvent){case r.ACCOUNTS_CHANGED:{const e={isWalletEvent:!0,type:i.WalletEventType.ACCOUNTS_CHANGED,data:t.payload};return window.postMessage(JSON.stringify(e),window.location.origin),Promise.resolve(!0)}case r.CHAIN_ID_CHANGED:{const e={isWalletEvent:!0,type:i.WalletEventType.CHAIN_CHANGED,data:t.payload};return window.postMessage(JSON.stringify(e),window.location.origin),Promise.resolve(!0)}case r.UNLOCK_CHANGED:{const e={isWalletEvent:!0,type:i.WalletEventType.ACCOUNTS_CHANGED,data:[]};return window.postMessage(JSON.stringify(e),window.location.origin),Promise.resolve(!0)}case r.ACCOUNT_CHANGED:{const e={direction:"from-ronin-content-script",roninEvent:r.ACCOUNT_CHANGED,detail:t.payload};return window.postMessage(e,window.location.origin),Promise.resolve(!0)}}});setInterval(()=>{s.runtime.sendMessage({type:l.KEEP_ALIVE_FROM_CONTENT_SCRIPT})},1e4);const u=async()=>{await d(100);const t={isWalletEvent:!0,type:i.WalletEventType.CONTENT_SCRIPT_READY};window.postMessage(JSON.stringify(t),window.location.origin)};u();
