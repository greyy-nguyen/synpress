import{p as Xt,E as Bt,B as D}from"../ethers.CrVDN1GO.js";import{g as Ht}from"../lodash.BduLK7P_.js";var ye={exports:{}};const qt="2.0.0",$t=256,Yt=Number.MAX_SAFE_INTEGER||9007199254740991,zt=16,Kt=$t-6,kt=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var pe={MAX_LENGTH:$t,MAX_SAFE_COMPONENT_LENGTH:zt,MAX_SAFE_BUILD_LENGTH:Kt,MAX_SAFE_INTEGER:Yt,RELEASE_TYPES:kt,SEMVER_SPEC_VERSION:qt,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Re={};const Wt=typeof Xt=="object"&&Re&&Re.NODE_DEBUG&&/\bsemver\b/i.test(Re.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var me=Wt;(function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:n}=pe,i=me;e=r.exports={};const c=e.re=[],u=e.safeRe=[],o=e.src=[],a=e.t={};let l=0;const E="[a-zA-Z0-9-]",N=[["\\s",1],["\\d",n],[E,s]],p=P=>{for(const[y,G]of N)P=P.split(`${y}*`).join(`${y}{0,${G}}`).split(`${y}+`).join(`${y}{1,${G}}`);return P},m=(P,y,G)=>{const x=p(y),q=l++;i(P,q,y),a[P]=q,o[q]=y,c[q]=new RegExp(y,G?"g":void 0),u[q]=new RegExp(x,G?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${E}*`),m("MAINVERSION",`(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${o[a.NUMERICIDENTIFIER]}|${o[a.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${o[a.NUMERICIDENTIFIERLOOSE]}|${o[a.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${o[a.PRERELEASEIDENTIFIER]}(?:\\.${o[a.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${o[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[a.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${E}+`),m("BUILD",`(?:\\+(${o[a.BUILDIDENTIFIER]}(?:\\.${o[a.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${o[a.MAINVERSION]}${o[a.PRERELEASE]}?${o[a.BUILD]}?`),m("FULL",`^${o[a.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${o[a.MAINVERSIONLOOSE]}${o[a.PRERELEASELOOSE]}?${o[a.BUILD]}?`),m("LOOSE",`^${o[a.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${o[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${o[a.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:${o[a.PRERELEASE]})?${o[a.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:${o[a.PRERELEASELOOSE]})?${o[a.BUILD]}?)?)?`),m("XRANGE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${o[a.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",o[a.COERCEPLAIN]+`(?:${o[a.PRERELEASE]})?(?:${o[a.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",o[a.COERCE],!0),m("COERCERTLFULL",o[a.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${o[a.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${o[a.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${o[a.LONECARET]}${o[a.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${o[a.LONECARET]}${o[a.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${o[a.GTLT]}\\s*(${o[a.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]}|${o[a.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${o[a.XRANGEPLAIN]})\\s+-\\s+(${o[a.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${o[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[a.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(ye,ye.exports);var ae=ye.exports;const Zt=Object.freeze({loose:!0}),Jt=Object.freeze({}),Qt=r=>r?typeof r!="object"?Zt:r:Jt;var Ce=Qt;const Be=/^[0-9]+$/,Rt=(r,e)=>{const t=Be.test(r),s=Be.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},er=(r,e)=>Rt(e,r);var Nt={compareIdentifiers:Rt,rcompareIdentifiers:er};const ce=me,{MAX_LENGTH:He,MAX_SAFE_INTEGER:le}=pe,{safeRe:qe,t:Ye}=ae,tr=Ce,{compareIdentifiers:W}=Nt;let rr=class M{constructor(e,t){if(t=tr(t),e instanceof M){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>He)throw new TypeError(`version is longer than ${He} characters`);ce("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const s=e.trim().match(t.loose?qe[Ye.LOOSE]:qe[Ye.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>le||this.major<0)throw new TypeError("Invalid major version");if(this.minor>le||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>le||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){const i=+n;if(i>=0&&i<le)return i}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ce("SemVer.compare",this.version,this.options,e),!(e instanceof M)){if(typeof e=="string"&&e===this.version)return 0;e=new M(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof M||(e=new M(e,this.options)),W(this.major,e.major)||W(this.minor,e.minor)||W(this.patch,e.patch)}comparePre(e){if(e instanceof M||(e=new M(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const s=this.prerelease[t],n=e.prerelease[t];if(ce("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return W(s,n)}while(++t)}compareBuild(e){e instanceof M||(e=new M(e,this.options));let t=0;do{const s=this.build[t],n=e.build[t];if(ce("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return W(s,n)}while(++t)}inc(e,t,s){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,s),this.inc("pre",t,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,s),this.inc("pre",t,s);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const n=Number(s)?1:0;if(!t&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[n];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(n)}}if(t){let i=[t,n];s===!1&&(i=[t]),W(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var w=rr;const ze=w,sr=(r,e,t=!1)=>{if(r instanceof ze)return r;try{return new ze(r,e)}catch(s){if(!t)return null;throw s}};var ee=sr;const nr=ee,ir=(r,e)=>{const t=nr(r,e);return t?t.version:null};var or=ir;const ar=ee,cr=(r,e)=>{const t=ar(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};var lr=cr;const Ke=w,ur=(r,e,t,s,n)=>{typeof t=="string"&&(n=s,s=t,t=void 0);try{return new Ke(r instanceof Ke?r.version:r,t).inc(e,s,n).version}catch{return null}};var hr=ur;const ke=ee,fr=(r,e)=>{const t=ke(r,null,!0),s=ke(e,null,!0),n=t.compare(s);if(n===0)return null;const i=n>0,c=i?t:s,u=i?s:t,o=!!c.prerelease.length;if(!!u.prerelease.length&&!o)return!u.patch&&!u.minor?"major":c.patch?"patch":c.minor?"minor":"major";const l=o?"pre":"";return t.major!==s.major?l+"major":t.minor!==s.minor?l+"minor":t.patch!==s.patch?l+"patch":"prerelease"};var Er=fr;const dr=w,pr=(r,e)=>new dr(r,e).major;var mr=pr;const vr=w,Ir=(r,e)=>new vr(r,e).minor;var gr=Ir;const $r=w,Rr=(r,e)=>new $r(r,e).patch;var Nr=Rr;const Sr=ee,Tr=(r,e)=>{const t=Sr(r,e);return t&&t.prerelease.length?t.prerelease:null};var Or=Tr;const We=w,Lr=(r,e,t)=>new We(r,t).compare(new We(e,t));var U=Lr;const Ar=U,xr=(r,e,t)=>Ar(e,r,t);var _r=xr;const yr=U,wr=(r,e)=>yr(r,e,!0);var Cr=wr;const Ze=w,Dr=(r,e,t)=>{const s=new Ze(r,t),n=new Ze(e,t);return s.compare(n)||s.compareBuild(n)};var De=Dr;const Pr=De,br=(r,e)=>r.sort((t,s)=>Pr(t,s,e));var Ur=br;const Fr=De,Gr=(r,e)=>r.sort((t,s)=>Fr(s,t,e));var Mr=Gr;const Vr=U,jr=(r,e,t)=>Vr(r,e,t)>0;var ve=jr;const Xr=U,Br=(r,e,t)=>Xr(r,e,t)<0;var Pe=Br;const Hr=U,qr=(r,e,t)=>Hr(r,e,t)===0;var St=qr;const Yr=U,zr=(r,e,t)=>Yr(r,e,t)!==0;var Tt=zr;const Kr=U,kr=(r,e,t)=>Kr(r,e,t)>=0;var be=kr;const Wr=U,Zr=(r,e,t)=>Wr(r,e,t)<=0;var Ue=Zr;const Jr=St,Qr=Tt,es=ve,ts=be,rs=Pe,ss=Ue,ns=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return Jr(r,t,s);case"!=":return Qr(r,t,s);case">":return es(r,t,s);case">=":return ts(r,t,s);case"<":return rs(r,t,s);case"<=":return ss(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}};var Ot=ns;const is=w,os=ee,{safeRe:ue,t:he}=ae,as=(r,e)=>{if(r instanceof is)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?ue[he.COERCEFULL]:ue[he.COERCE]);else{const o=e.includePrerelease?ue[he.COERCERTLFULL]:ue[he.COERCERTL];let a;for(;(a=o.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||a.index+a[0].length!==t.index+t[0].length)&&(t=a),o.lastIndex=a.index+a[1].length+a[2].length;o.lastIndex=-1}if(t===null)return null;const s=t[2],n=t[3]||"0",i=t[4]||"0",c=e.includePrerelease&&t[5]?`-${t[5]}`:"",u=e.includePrerelease&&t[6]?`+${t[6]}`:"";return os(`${s}.${n}.${i}${c}${u}`,e)};var cs=as,Ne,Je;function ls(){return Je||(Je=1,Ne=function(r){r.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}),Ne}var us=S;S.Node=k;S.create=S;function S(r){var e=this;if(e instanceof S||(e=new S),e.tail=null,e.head=null,e.length=0,r&&typeof r.forEach=="function")r.forEach(function(n){e.push(n)});else if(arguments.length>0)for(var t=0,s=arguments.length;t<s;t++)e.push(arguments[t]);return e}S.prototype.removeNode=function(r){if(r.list!==this)throw new Error("removing node which does not belong to this list");var e=r.next,t=r.prev;return e&&(e.prev=t),t&&(t.next=e),r===this.head&&(this.head=e),r===this.tail&&(this.tail=t),r.list.length--,r.next=null,r.prev=null,r.list=null,e};S.prototype.unshiftNode=function(r){if(r!==this.head){r.list&&r.list.removeNode(r);var e=this.head;r.list=this,r.next=e,e&&(e.prev=r),this.head=r,this.tail||(this.tail=r),this.length++}};S.prototype.pushNode=function(r){if(r!==this.tail){r.list&&r.list.removeNode(r);var e=this.tail;r.list=this,r.prev=e,e&&(e.next=r),this.tail=r,this.head||(this.head=r),this.length++}};S.prototype.push=function(){for(var r=0,e=arguments.length;r<e;r++)fs(this,arguments[r]);return this.length};S.prototype.unshift=function(){for(var r=0,e=arguments.length;r<e;r++)Es(this,arguments[r]);return this.length};S.prototype.pop=function(){if(this.tail){var r=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,r}};S.prototype.shift=function(){if(this.head){var r=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,r}};S.prototype.forEach=function(r,e){e=e||this;for(var t=this.head,s=0;t!==null;s++)r.call(e,t.value,s,this),t=t.next};S.prototype.forEachReverse=function(r,e){e=e||this;for(var t=this.tail,s=this.length-1;t!==null;s--)r.call(e,t.value,s,this),t=t.prev};S.prototype.get=function(r){for(var e=0,t=this.head;t!==null&&e<r;e++)t=t.next;if(e===r&&t!==null)return t.value};S.prototype.getReverse=function(r){for(var e=0,t=this.tail;t!==null&&e<r;e++)t=t.prev;if(e===r&&t!==null)return t.value};S.prototype.map=function(r,e){e=e||this;for(var t=new S,s=this.head;s!==null;)t.push(r.call(e,s.value,this)),s=s.next;return t};S.prototype.mapReverse=function(r,e){e=e||this;for(var t=new S,s=this.tail;s!==null;)t.push(r.call(e,s.value,this)),s=s.prev;return t};S.prototype.reduce=function(r,e){var t,s=this.head;if(arguments.length>1)t=e;else if(this.head)s=this.head.next,t=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;s!==null;n++)t=r(t,s.value,n),s=s.next;return t};S.prototype.reduceReverse=function(r,e){var t,s=this.tail;if(arguments.length>1)t=e;else if(this.tail)s=this.tail.prev,t=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=this.length-1;s!==null;n--)t=r(t,s.value,n),s=s.prev;return t};S.prototype.toArray=function(){for(var r=new Array(this.length),e=0,t=this.head;t!==null;e++)r[e]=t.value,t=t.next;return r};S.prototype.toArrayReverse=function(){for(var r=new Array(this.length),e=0,t=this.tail;t!==null;e++)r[e]=t.value,t=t.prev;return r};S.prototype.slice=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new S;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var s=0,n=this.head;n!==null&&s<r;s++)n=n.next;for(;n!==null&&s<e;s++,n=n.next)t.push(n.value);return t};S.prototype.sliceReverse=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new S;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var s=this.length,n=this.tail;n!==null&&s>e;s--)n=n.prev;for(;n!==null&&s>r;s--,n=n.prev)t.push(n.value);return t};S.prototype.splice=function(r,e,...t){r>this.length&&(r=this.length-1),r<0&&(r=this.length+r);for(var s=0,n=this.head;n!==null&&s<r;s++)n=n.next;for(var i=[],s=0;n&&s<e;s++)i.push(n.value),n=this.removeNode(n);n===null&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(var s=0;s<t.length;s++)n=hs(this,n,t[s]);return i};S.prototype.reverse=function(){for(var r=this.head,e=this.tail,t=r;t!==null;t=t.prev){var s=t.prev;t.prev=t.next,t.next=s}return this.head=e,this.tail=r,this};function hs(r,e,t){var s=e===r.head?new k(t,null,e,r):new k(t,e,e.next,r);return s.next===null&&(r.tail=s),s.prev===null&&(r.head=s),r.length++,s}function fs(r,e){r.tail=new k(e,r.tail,null,r),r.head||(r.head=r.tail),r.length++}function Es(r,e){r.head=new k(e,null,r.head,r),r.tail||(r.tail=r.head),r.length++}function k(r,e,t,s){if(!(this instanceof k))return new k(r,e,t,s);this.list=s,this.value=r,e?(e.next=this,this.prev=e):this.prev=null,t?(t.prev=this,this.next=t):this.next=null}try{ls()(S)}catch{}const ds=us,Y=Symbol("max"),j=Symbol("length"),Z=Symbol("lengthCalculator"),ne=Symbol("allowStale"),z=Symbol("maxAge"),V=Symbol("dispose"),Qe=Symbol("noDisposeOnSet"),_=Symbol("lruList"),b=Symbol("cache"),Lt=Symbol("updateAgeOnGet"),Se=()=>1;class ps{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[Y]=e.max||1/0;const t=e.length||Se;if(this[Z]=typeof t!="function"?Se:t,this[ne]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[z]=e.maxAge||0,this[V]=e.dispose,this[Qe]=e.noDisposeOnSet||!1,this[Lt]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[Y]=e||1/0,re(this)}get max(){return this[Y]}set allowStale(e){this[ne]=!!e}get allowStale(){return this[ne]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[z]=e,re(this)}get maxAge(){return this[z]}set lengthCalculator(e){typeof e!="function"&&(e=Se),e!==this[Z]&&(this[Z]=e,this[j]=0,this[_].forEach(t=>{t.length=this[Z](t.value,t.key),this[j]+=t.length})),re(this)}get lengthCalculator(){return this[Z]}get length(){return this[j]}get itemCount(){return this[_].length}rforEach(e,t){t=t||this;for(let s=this[_].tail;s!==null;){const n=s.prev;et(this,e,s,t),s=n}}forEach(e,t){t=t||this;for(let s=this[_].head;s!==null;){const n=s.next;et(this,e,s,t),s=n}}keys(){return this[_].toArray().map(e=>e.key)}values(){return this[_].toArray().map(e=>e.value)}reset(){this[V]&&this[_]&&this[_].length&&this[_].forEach(e=>this[V](e.key,e.value)),this[b]=new Map,this[_]=new ds,this[j]=0}dump(){return this[_].map(e=>Ee(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[_]}set(e,t,s){if(s=s||this[z],s&&typeof s!="number")throw new TypeError("maxAge must be a number");const n=s?Date.now():0,i=this[Z](t,e);if(this[b].has(e)){if(i>this[Y])return J(this,this[b].get(e)),!1;const o=this[b].get(e).value;return this[V]&&(this[Qe]||this[V](e,o.value)),o.now=n,o.maxAge=s,o.value=t,this[j]+=i-o.length,o.length=i,this.get(e),re(this),!0}const c=new ms(e,t,i,n,s);return c.length>this[Y]?(this[V]&&this[V](e,t),!1):(this[j]+=c.length,this[_].unshift(c),this[b].set(e,this[_].head),re(this),!0)}has(e){if(!this[b].has(e))return!1;const t=this[b].get(e).value;return!Ee(this,t)}get(e){return Te(this,e,!0)}peek(e){return Te(this,e,!1)}pop(){const e=this[_].tail;return e?(J(this,e),e.value):null}del(e){J(this,this[b].get(e))}load(e){this.reset();const t=Date.now();for(let s=e.length-1;s>=0;s--){const n=e[s],i=n.e||0;if(i===0)this.set(n.k,n.v);else{const c=i-t;c>0&&this.set(n.k,n.v,c)}}}prune(){this[b].forEach((e,t)=>Te(this,t,!1))}}const Te=(r,e,t)=>{const s=r[b].get(e);if(s){const n=s.value;if(Ee(r,n)){if(J(r,s),!r[ne])return}else t&&(r[Lt]&&(s.value.now=Date.now()),r[_].unshiftNode(s));return n.value}},Ee=(r,e)=>{if(!e||!e.maxAge&&!r[z])return!1;const t=Date.now()-e.now;return e.maxAge?t>e.maxAge:r[z]&&t>r[z]},re=r=>{if(r[j]>r[Y])for(let e=r[_].tail;r[j]>r[Y]&&e!==null;){const t=e.prev;J(r,e),e=t}},J=(r,e)=>{if(e){const t=e.value;r[V]&&r[V](t.key,t.value),r[j]-=t.length,r[b].delete(t.key),r[_].removeNode(e)}};class ms{constructor(e,t,s,n,i){this.key=e,this.value=t,this.length=s,this.now=n,this.maxAge=i||0}}const et=(r,e,t,s)=>{let n=t.value;Ee(r,n)&&(J(r,t),r[ne]||(n=void 0)),n&&e.call(s,n.value,n.key,r)};var vs=ps,Oe,tt;function F(){if(tt)return Oe;tt=1;class r{constructor(h,g){if(g=s(g),h instanceof r)return h.loose===!!g.loose&&h.includePrerelease===!!g.includePrerelease?h:new r(h.raw,g);if(h instanceof n)return this.raw=h.value,this.set=[[h]],this.format(),this;if(this.options=g,this.loose=!!g.loose,this.includePrerelease=!!g.includePrerelease,this.raw=h.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(v=>this.parseRange(v.trim())).filter(v=>v.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const v=this.set[0];if(this.set=this.set.filter(I=>!m(I[0])),this.set.length===0)this.set=[v];else if(this.set.length>1){for(const I of this.set)if(I.length===1&&P(I[0])){this.set=[I];break}}}this.format()}format(){return this.range=this.set.map(h=>h.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(h){const v=((this.options.includePrerelease&&N)|(this.options.loose&&p))+":"+h,I=t.get(v);if(I)return I;const d=this.options.loose,$=d?u[o.HYPHENRANGELOOSE]:u[o.HYPHENRANGE];h=h.replace($,Vt(this.options.includePrerelease)),i("hyphen replace",h),h=h.replace(u[o.COMPARATORTRIM],a),i("comparator trim",h),h=h.replace(u[o.TILDETRIM],l),i("tilde trim",h),h=h.replace(u[o.CARETTRIM],E),i("caret trim",h);let T=h.split(" ").map(L=>G(L,this.options)).join(" ").split(/\s+/).map(L=>Mt(L,this.options));d&&(T=T.filter(L=>(i("loose invalid filter",L,this.options),!!L.match(u[o.COMPARATORLOOSE])))),i("range list",T);const R=new Map,O=T.map(L=>new n(L,this.options));for(const L of O){if(m(L))return[L];R.set(L.value,L)}R.size>1&&R.has("")&&R.delete("");const C=[...R.values()];return t.set(v,C),C}intersects(h,g){if(!(h instanceof r))throw new TypeError("a Range is required");return this.set.some(v=>y(v,g)&&h.set.some(I=>y(I,g)&&v.every(d=>I.every($=>d.intersects($,g)))))}test(h){if(!h)return!1;if(typeof h=="string")try{h=new c(h,this.options)}catch{return!1}for(let g=0;g<this.set.length;g++)if(jt(this.set[g],h,this.options))return!0;return!1}}Oe=r;const e=vs,t=new e({max:1e3}),s=Ce,n=Ie(),i=me,c=w,{safeRe:u,t:o,comparatorTrimReplace:a,tildeTrimReplace:l,caretTrimReplace:E}=ae,{FLAG_INCLUDE_PRERELEASE:N,FLAG_LOOSE:p}=pe,m=f=>f.value==="<0.0.0-0",P=f=>f.value==="",y=(f,h)=>{let g=!0;const v=f.slice();let I=v.pop();for(;g&&v.length;)g=v.every(d=>I.intersects(d,h)),I=v.pop();return g},G=(f,h)=>(i("comp",f,h),f=Pt(f,h),i("caret",f),f=q(f,h),i("tildes",f),f=Ut(f,h),i("xrange",f),f=Gt(f,h),i("stars",f),f),x=f=>!f||f.toLowerCase()==="x"||f==="*",q=(f,h)=>f.trim().split(/\s+/).map(g=>Dt(g,h)).join(" "),Dt=(f,h)=>{const g=h.loose?u[o.TILDELOOSE]:u[o.TILDE];return f.replace(g,(v,I,d,$,T)=>{i("tilde",f,v,I,d,$,T);let R;return x(I)?R="":x(d)?R=`>=${I}.0.0 <${+I+1}.0.0-0`:x($)?R=`>=${I}.${d}.0 <${I}.${+d+1}.0-0`:T?(i("replaceTilde pr",T),R=`>=${I}.${d}.${$}-${T} <${I}.${+d+1}.0-0`):R=`>=${I}.${d}.${$} <${I}.${+d+1}.0-0`,i("tilde return",R),R})},Pt=(f,h)=>f.trim().split(/\s+/).map(g=>bt(g,h)).join(" "),bt=(f,h)=>{i("caret",f,h);const g=h.loose?u[o.CARETLOOSE]:u[o.CARET],v=h.includePrerelease?"-0":"";return f.replace(g,(I,d,$,T,R)=>{i("caret",f,I,d,$,T,R);let O;return x(d)?O="":x($)?O=`>=${d}.0.0${v} <${+d+1}.0.0-0`:x(T)?d==="0"?O=`>=${d}.${$}.0${v} <${d}.${+$+1}.0-0`:O=`>=${d}.${$}.0${v} <${+d+1}.0.0-0`:R?(i("replaceCaret pr",R),d==="0"?$==="0"?O=`>=${d}.${$}.${T}-${R} <${d}.${$}.${+T+1}-0`:O=`>=${d}.${$}.${T}-${R} <${d}.${+$+1}.0-0`:O=`>=${d}.${$}.${T}-${R} <${+d+1}.0.0-0`):(i("no pr"),d==="0"?$==="0"?O=`>=${d}.${$}.${T}${v} <${d}.${$}.${+T+1}-0`:O=`>=${d}.${$}.${T}${v} <${d}.${+$+1}.0-0`:O=`>=${d}.${$}.${T} <${+d+1}.0.0-0`),i("caret return",O),O})},Ut=(f,h)=>(i("replaceXRanges",f,h),f.split(/\s+/).map(g=>Ft(g,h)).join(" ")),Ft=(f,h)=>{f=f.trim();const g=h.loose?u[o.XRANGELOOSE]:u[o.XRANGE];return f.replace(g,(v,I,d,$,T,R)=>{i("xRange",f,v,I,d,$,T,R);const O=x(d),C=O||x($),L=C||x(T),te=L;return I==="="&&te&&(I=""),R=h.includePrerelease?"-0":"",O?I===">"||I==="<"?v="<0.0.0-0":v="*":I&&te?(C&&($=0),T=0,I===">"?(I=">=",C?(d=+d+1,$=0,T=0):($=+$+1,T=0)):I==="<="&&(I="<",C?d=+d+1:$=+$+1),I==="<"&&(R="-0"),v=`${I+d}.${$}.${T}${R}`):C?v=`>=${d}.0.0${R} <${+d+1}.0.0-0`:L&&(v=`>=${d}.${$}.0${R} <${d}.${+$+1}.0-0`),i("xRange return",v),v})},Gt=(f,h)=>(i("replaceStars",f,h),f.trim().replace(u[o.STAR],"")),Mt=(f,h)=>(i("replaceGTE0",f,h),f.trim().replace(u[h.includePrerelease?o.GTE0PRE:o.GTE0],"")),Vt=f=>(h,g,v,I,d,$,T,R,O,C,L,te,oi)=>(x(v)?g="":x(I)?g=`>=${v}.0.0${f?"-0":""}`:x(d)?g=`>=${v}.${I}.0${f?"-0":""}`:$?g=`>=${g}`:g=`>=${g}${f?"-0":""}`,x(O)?R="":x(C)?R=`<${+O+1}.0.0-0`:x(L)?R=`<${O}.${+C+1}.0-0`:te?R=`<=${O}.${C}.${L}-${te}`:f?R=`<${O}.${C}.${+L+1}-0`:R=`<=${R}`,`${g} ${R}`.trim()),jt=(f,h,g)=>{for(let v=0;v<f.length;v++)if(!f[v].test(h))return!1;if(h.prerelease.length&&!g.includePrerelease){for(let v=0;v<f.length;v++)if(i(f[v].semver),f[v].semver!==n.ANY&&f[v].semver.prerelease.length>0){const I=f[v].semver;if(I.major===h.major&&I.minor===h.minor&&I.patch===h.patch)return!0}return!1}return!0};return Oe}var Le,rt;function Ie(){if(rt)return Le;rt=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(l,E){if(E=t(E),l instanceof e){if(l.loose===!!E.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),c("comparator",l,E),this.options=E,this.loose=!!E.loose,this.parse(l),this.semver===r?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(l){const E=this.options.loose?s[n.COMPARATORLOOSE]:s[n.COMPARATOR],N=l.match(E);if(!N)throw new TypeError(`Invalid comparator: ${l}`);this.operator=N[1]!==void 0?N[1]:"",this.operator==="="&&(this.operator=""),N[2]?this.semver=new u(N[2],this.options.loose):this.semver=r}toString(){return this.value}test(l){if(c("Comparator.test",l,this.options.loose),this.semver===r||l===r)return!0;if(typeof l=="string")try{l=new u(l,this.options)}catch{return!1}return i(l,this.operator,this.semver,this.options)}intersects(l,E){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new o(l.value,E).test(this.value):l.operator===""?l.value===""?!0:new o(this.value,E).test(l.semver):(E=t(E),E.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!E.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||i(this.semver,"<",l.semver,E)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||i(this.semver,">",l.semver,E)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}Le=e;const t=Ce,{safeRe:s,t:n}=ae,i=Ot,c=me,u=w,o=F();return Le}const Is=F(),gs=(r,e,t)=>{try{e=new Is(e,t)}catch{return!1}return e.test(r)};var ge=gs;const $s=F(),Rs=(r,e)=>new $s(r,e).set.map(t=>t.map(s=>s.value).join(" ").trim().split(" "));var Ns=Rs;const Ss=w,Ts=F(),Os=(r,e,t)=>{let s=null,n=null,i=null;try{i=new Ts(e,t)}catch{return null}return r.forEach(c=>{i.test(c)&&(!s||n.compare(c)===-1)&&(s=c,n=new Ss(s,t))}),s};var Ls=Os;const As=w,xs=F(),_s=(r,e,t)=>{let s=null,n=null,i=null;try{i=new xs(e,t)}catch{return null}return r.forEach(c=>{i.test(c)&&(!s||n.compare(c)===1)&&(s=c,n=new As(s,t))}),s};var ys=_s;const Ae=w,ws=F(),st=ve,Cs=(r,e)=>{r=new ws(r,e);let t=new Ae("0.0.0");if(r.test(t)||(t=new Ae("0.0.0-0"),r.test(t)))return t;t=null;for(let s=0;s<r.set.length;++s){const n=r.set[s];let i=null;n.forEach(c=>{const u=new Ae(c.semver.version);switch(c.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!i||st(u,i))&&(i=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${c.operator}`)}}),i&&(!t||st(t,i))&&(t=i)}return t&&r.test(t)?t:null};var Ds=Cs;const Ps=F(),bs=(r,e)=>{try{return new Ps(r,e).range||"*"}catch{return null}};var Us=bs;const Fs=w,At=Ie(),{ANY:Gs}=At,Ms=F(),Vs=ge,nt=ve,it=Pe,js=Ue,Xs=be,Bs=(r,e,t,s)=>{r=new Fs(r,s),e=new Ms(e,s);let n,i,c,u,o;switch(t){case">":n=nt,i=js,c=it,u=">",o=">=";break;case"<":n=it,i=Xs,c=nt,u="<",o="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Vs(r,e,s))return!1;for(let a=0;a<e.set.length;++a){const l=e.set[a];let E=null,N=null;if(l.forEach(p=>{p.semver===Gs&&(p=new At(">=0.0.0")),E=E||p,N=N||p,n(p.semver,E.semver,s)?E=p:c(p.semver,N.semver,s)&&(N=p)}),E.operator===u||E.operator===o||(!N.operator||N.operator===u)&&i(r,N.semver))return!1;if(N.operator===o&&c(r,N.semver))return!1}return!0};var Fe=Bs;const Hs=Fe,qs=(r,e,t)=>Hs(r,e,">",t);var Ys=qs;const zs=Fe,Ks=(r,e,t)=>zs(r,e,"<",t);var ks=Ks;const ot=F(),Ws=(r,e,t)=>(r=new ot(r,t),e=new ot(e,t),r.intersects(e,t));var Zs=Ws;const Js=ge,Qs=U;var en=(r,e,t)=>{const s=[];let n=null,i=null;const c=r.sort((l,E)=>Qs(l,E,t));for(const l of c)Js(l,e,t)?(i=l,n||(n=l)):(i&&s.push([n,i]),i=null,n=null);n&&s.push([n,null]);const u=[];for(const[l,E]of s)l===E?u.push(l):!E&&l===c[0]?u.push("*"):E?l===c[0]?u.push(`<=${E}`):u.push(`${l} - ${E}`):u.push(`>=${l}`);const o=u.join(" || "),a=typeof e.raw=="string"?e.raw:String(e);return o.length<a.length?o:e};const at=F(),Ge=Ie(),{ANY:xe}=Ge,se=ge,Me=U,tn=(r,e,t={})=>{if(r===e)return!0;r=new at(r,t),e=new at(e,t);let s=!1;e:for(const n of r.set){for(const i of e.set){const c=sn(n,i,t);if(s=s||c!==null,c)continue e}if(s)return!1}return!0},rn=[new Ge(">=0.0.0-0")],ct=[new Ge(">=0.0.0")],sn=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===xe){if(e.length===1&&e[0].semver===xe)return!0;t.includePrerelease?r=rn:r=ct}if(e.length===1&&e[0].semver===xe){if(t.includePrerelease)return!0;e=ct}const s=new Set;let n,i;for(const p of r)p.operator===">"||p.operator===">="?n=lt(n,p,t):p.operator==="<"||p.operator==="<="?i=ut(i,p,t):s.add(p.semver);if(s.size>1)return null;let c;if(n&&i){if(c=Me(n.semver,i.semver,t),c>0)return null;if(c===0&&(n.operator!==">="||i.operator!=="<="))return null}for(const p of s){if(n&&!se(p,String(n),t)||i&&!se(p,String(i),t))return null;for(const m of e)if(!se(p,String(m),t))return!1;return!0}let u,o,a,l,E=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,N=n&&!t.includePrerelease&&n.semver.prerelease.length?n.semver:!1;E&&E.prerelease.length===1&&i.operator==="<"&&E.prerelease[0]===0&&(E=!1);for(const p of e){if(l=l||p.operator===">"||p.operator===">=",a=a||p.operator==="<"||p.operator==="<=",n){if(N&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===N.major&&p.semver.minor===N.minor&&p.semver.patch===N.patch&&(N=!1),p.operator===">"||p.operator===">="){if(u=lt(n,p,t),u===p&&u!==n)return!1}else if(n.operator===">="&&!se(n.semver,String(p),t))return!1}if(i){if(E&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===E.major&&p.semver.minor===E.minor&&p.semver.patch===E.patch&&(E=!1),p.operator==="<"||p.operator==="<="){if(o=ut(i,p,t),o===p&&o!==i)return!1}else if(i.operator==="<="&&!se(i.semver,String(p),t))return!1}if(!p.operator&&(i||n)&&c!==0)return!1}return!(n&&a&&!i&&c!==0||i&&l&&!n&&c!==0||N||E)},lt=(r,e,t)=>{if(!r)return e;const s=Me(r.semver,e.semver,t);return s>0?r:s<0||e.operator===">"&&r.operator===">="?e:r},ut=(r,e,t)=>{if(!r)return e;const s=Me(r.semver,e.semver,t);return s<0?r:s>0||e.operator==="<"&&r.operator==="<="?e:r};var nn=tn;const _e=ae,ht=pe,on=w,ft=Nt,an=ee,cn=or,ln=lr,un=hr,hn=Er,fn=mr,En=gr,dn=Nr,pn=Or,mn=U,vn=_r,In=Cr,gn=De,$n=Ur,Rn=Mr,Nn=ve,Sn=Pe,Tn=St,On=Tt,Ln=be,An=Ue,xn=Ot,_n=cs,yn=Ie(),wn=F(),Cn=ge,Dn=Ns,Pn=Ls,bn=ys,Un=Ds,Fn=Us,Gn=Fe,Mn=Ys,Vn=ks,jn=Zs,Xn=en,Bn=nn;var Hn={parse:an,valid:cn,clean:ln,inc:un,diff:hn,major:fn,minor:En,patch:dn,prerelease:pn,compare:mn,rcompare:vn,compareLoose:In,compareBuild:gn,sort:$n,rsort:Rn,gt:Nn,lt:Sn,eq:Tn,neq:On,gte:Ln,lte:An,cmp:xn,coerce:_n,Comparator:yn,Range:wn,satisfies:Cn,toComparators:Dn,maxSatisfying:Pn,minSatisfying:bn,minVersion:Un,validRange:Fn,outside:Gn,gtr:Mn,ltr:Vn,intersects:jn,simplifyRange:Xn,subset:Bn,SemVer:on,re:_e.re,src:_e.src,tokens:_e.t,SEMVER_SPEC_VERSION:ht.SEMVER_SPEC_VERSION,RELEASE_TYPES:ht.RELEASE_TYPES,compareIdentifiers:ft.compareIdentifiers,rcompareIdentifiers:ft.rcompareIdentifiers};const Et=Ht(Hn);let xt=0;const B=[],dt=(r,e,t)=>{const s={type:r,id:String(++xt),date:new Date};e&&(s.message=e),t&&(s.data=t),_t(s)},qn=({type:r,message:e,data:t,context:s})=>{const n={type:r,id:String(++xt),date:new Date};e&&(n.message=e),t&&(n.data=t),s&&(n.context=s),_t(n)};class ie{constructor(e,t){this.type=e,this.context=t}trace(e,t){qn({type:this.type,message:e,data:t,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new ie(e,this.context)}withContext(e){return new ie(this.type,e)}withUpdatedContext(e){return new ie(this.type,Object.assign(Object.assign({},this.context),e))}}const Yn=r=>(B.push(r),()=>{const e=B.indexOf(r);e!==-1&&(B[e]=B[B.length-1],B.pop())});function _t(r){for(let e=0;e<B.length;e++)try{B[e](r)}catch(t){console.error(t)}}typeof window<"u"&&(window.__ledgerLogsListen=Yn);const $e=r=>{class e extends Error{constructor(s,n,i){if(super(s||r,i),Object.setPrototypeOf(this,e.prototype),this.name=r,n)for(const c in n)this[c]=n[c];if(i&&zn(i)&&"cause"in i&&!("cause"in this)){const c=i.cause;this.cause=c,"stack"in c&&(this.stack=this.stack+`
CAUSE: `+c.stack)}}}return e};function zn(r){return typeof r=="object"}const Kn=$e("DisconnectedDevice"),kn=$e("DisconnectedDeviceDuringOperation"),pt=$e("TransportOpenUserCancelled"),Wn=$e("TransportRaceCondition");var mt;(function(r){r.Unknown="Unknown",r.LocationServicesDisabled="LocationServicesDisabled",r.LocationServicesUnauthorized="LocationServicesUnauthorized",r.BluetoothScanStartFailed="BluetoothScanStartFailed"})(mt||(mt={}));class H extends Error{constructor(e,t){const s="TransportError";super(e||s),this.name=s,this.message=e,this.stack=new Error(e).stack,this.id=t}}const Q={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,DEVICE_IN_RECOVERY_MODE:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738,APP_NOT_FOUND_OR_INVALID_CONTEXT:20771,INVALID_APP_NAME_LENGTH:26378,GEN_AES_KEY_FAILED:21529,INTERNAL_CRYPTO_OPERATION_FAILED:21530,INTERNAL_COMPUTE_AES_CMAC_FAILED:21531,ENCRYPT_APP_STORAGE_FAILED:21532,INVALID_BACKUP_STATE:26178,PIN_NOT_SET:21762,INVALID_BACKUP_LENGTH:26419,INVALID_RESTORE_STATE:26179,INVALID_CHUNK_LENGTH:26420,INVALID_BACKUP_HEADER:26698,TRUSTCHAIN_WRONG_SEED:45063};function Zn(r){switch(r){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=r&&r<=28671)return"Internal error, please report"}class oe extends Error{constructor(e,{canBeMappedToChildError:t=!0}={}){const s=Object.keys(Q).find(u=>Q[u]===e)||"UNKNOWN_ERROR",n=Zn(e)||s,i=e.toString(16),c=`Ledger device: ${n} (0x${i})`;if(super(c),this.name="TransportStatusError",this.statusCode=e,this.statusText=s,Object.setPrototypeOf(this,oe.prototype),t&&e===Q.LOCKED_DEVICE)return new Ve(c)}}class Ve extends oe{constructor(e){super(Q.LOCKED_DEVICE,{canBeMappedToChildError:!1}),e&&(this.message=e),this.name="LockedDeviceError",Object.setPrototypeOf(this,Ve.prototype)}}var fe=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function u(l){try{a(s.next(l))}catch(E){c(E)}}function o(l){try{a(s.throw(l))}catch(E){c(E)}}function a(l){l.done?i(l.value):n(l.value).then(u,o)}a((s=s.apply(r,e||[])).next())})};const Jn="transport";class je{constructor({context:e,logType:t}={}){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new Bt,this.send=(s,n,i,c,...u)=>fe(this,[s,n,i,c,...u],void 0,function*(o,a,l,E,N=D.alloc(0),p=[Q.OK],{abortTimeoutMs:m}={}){const P=this.tracer.withUpdatedContext({function:"send"});if(N.length>=256)throw P.trace("data.length exceeded 256 bytes limit",{dataLength:N.length}),new H("data.length exceed 256 bytes limit. Got: "+N.length,"DataLengthTooBig");P.trace("Starting an exchange",{abortTimeoutMs:m});const y=yield this.exchange(D.concat([D.from([o,a,l,E]),D.from([N.length]),N]),{abortTimeoutMs:m});P.trace("Received response from exchange");const G=y.readUInt16BE(y.length-2);if(!p.some(x=>x===G))throw new oe(G);return y}),this._appAPIlock=null,this.tracer=new ie(t??Jn,e)}exchange(e,{abortTimeoutMs:t}={}){throw new Error("exchange not implemented")}exchangeBulk(e,t){let s=!1;const n=()=>{s=!0};return fe(this,void 0,void 0,function*(){if(!s)for(const c of e){const u=yield this.exchange(c);if(s)return;const o=u.readUInt16BE(u.length-2);if(o!==Q.OK)throw new oe(o);t.next(u)}}).then(()=>!s&&t.complete(),c=>!s&&t.error(c)),{unsubscribe:n}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise((s,n)=>{let i=!1;const c=this.listen({next:o=>{i=!0,c&&c.unsubscribe(),u&&clearTimeout(u),this.open(o.descriptor,e).then(s,n)},error:o=>{u&&clearTimeout(u),n(o)},complete:()=>{u&&clearTimeout(u),i||n(new H(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=t?setTimeout(()=>{c.unsubscribe(),n(new H(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},t):null})}exchangeAtomicImpl(e){return fe(this,void 0,void 0,function*(){const t=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw t.trace("Atomic exchange is already busy"),new Wn("An action was already pending on the Ledger device. Please deny or reconnect.");let s;const n=new Promise(u=>{s=u});this.exchangeBusyPromise=n;let i=!1;const c=setTimeout(()=>{t.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),i=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=yield e();return i&&(t.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{t.trace("Finalize, clearing busy guard"),clearTimeout(c),s&&s(),this.exchangeBusyPromise=null}})}decorateAppAPIMethods(e,t,s){for(const n of t)e[n]=this.decorateAppAPIMethod(n,e[n],e,s)}decorateAppAPIMethod(e,t,s,n){return(...i)=>fe(this,void 0,void 0,function*(){const{_appAPIlock:c}=this;if(c)return Promise.reject(new H("Ledger Device is busy (lock "+c+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(n),yield t.apply(s,i)}finally{this._appAPIlock=null}})}setTraceContext(e){this.tracer=this.tracer.withContext(e)}updateTraceContext(e){this.tracer.updateContext(e)}getTraceContext(){return this.tracer.getContext()}}je.ErrorMessage_ListenTimeout="No Ledger device found (timeout)";je.ErrorMessage_NoDeviceFound="No Ledger device found";const vt=5;function Qn(r){const e=D.alloc(2);return e.writeUInt16BE(r,0),e}const ei={data:D.alloc(0),dataLength:0,sequence:0},ti=(r,e)=>({makeBlocks(t){let s=D.concat([Qn(t.length),t]);const n=e-5,i=Math.ceil(s.length/n);s=D.concat([s,D.alloc(i*n-s.length+1).fill(0)]);const c=[];for(let u=0;u<i;u++){const o=D.alloc(5);o.writeUInt16BE(r,0),o.writeUInt8(vt,2),o.writeUInt16BE(u,3);const a=s.slice(u*n,(u+1)*n);c.push(D.concat([o,a]))}return c},reduceResponse(t,s){let{data:n,dataLength:i,sequence:c}=t||ei;if(s.readUInt16BE(0)!==r)throw new H("Invalid channel","InvalidChannel");if(s.readUInt8(2)!==vt)throw new H("Invalid tag","InvalidTag");if(s.readUInt16BE(3)!==c)throw new H("Invalid sequence","InvalidSequence");t||(i=s.readUInt16BE(5)),c++;const u=s.slice(t?5:7);return n=D.concat([n,u]),n.length>i&&(n=n.slice(0,i)),{data:n,dataLength:i,sequence:c}},getReducedResult(t){if(t&&t.dataLength===t.data.length)return t.data}});var A;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax",r.europa="europa"})(A||(A={}));const we={[A.blue]:{id:A.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[A.nanoS]:{id:A.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>{var e;return Et.lt((e=Et.coerce(r))!==null&&e!==void 0?e:"","2.0.0")?4*1024:2*1024}},[A.nanoX]:{id:A.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[A.nanoSP]:{id:A.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:r=>32},[A.stax]:{id:A.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[A.europa]:{id:A.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};A.blue,A.nanoS,A.nanoSP,A.nanoX,A.stax,A.europa;const It=Object.values(we),yt=11415,wt=r=>{const e=It.find(n=>n.legacyUsbProductId===r);if(e)return e;const t=r>>8;return It.find(n=>n.productIdMM===t)},ri=[],gt={};for(const r in we){const e=we[r],{bluetoothSpec:t}=e;if(t)for(let s=0;s<t.length;s++){const n=t[s];ri.push(n.serviceUuid),gt[n.serviceUuid]=gt[n.serviceUuid.replace(/-/g,"")]=Object.assign({deviceModel:e},n)}}var X=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function u(l){try{a(s.next(l))}catch(E){c(E)}}function o(l){try{a(s.throw(l))}catch(E){c(E)}}function a(l){l.done?i(l.value):n(l.value).then(u,o)}a((s=s.apply(r,e||[])).next())})};const si=[{vendorId:yt}],ni=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),de=()=>{const{hid:r}=navigator;if(!r)throw new H("navigator.hid is not supported","HIDNotSupported");return r};function Ct(){return X(this,void 0,void 0,function*(){const r=yield de().requestDevice({filters:si});return Array.isArray(r)?r:[r]})}function Xe(){return X(this,void 0,void 0,function*(){return(yield de().getDevices()).filter(e=>e.vendorId===yt)})}function ii(){return X(this,void 0,void 0,function*(){const r=yield Xe();return r.length>0?r[0]:(yield Ct())[0]})}class K extends je{constructor(e){super(),this.channel=Math.floor(Math.random()*65535),this.packetSize=64,this.inputs=[],this.read=()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(t=>{this.inputCallback=t}),this.onInputReport=t=>{const s=D.from(t.data.buffer);this.inputCallback?(this.inputCallback(s),this.inputCallback=null):this.inputs.push(s)},this._disconnectEmitted=!1,this._emitDisconnect=t=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",t))},this.exchange=t=>X(this,void 0,void 0,function*(){return yield this.exchangeAtomicImpl(()=>X(this,void 0,void 0,function*(){const{channel:n,packetSize:i}=this;dt("apdu","=> "+t.toString("hex"));const c=ti(n,i),u=c.makeBlocks(t);for(let l=0;l<u.length;l++)yield this.device.sendReport(0,u[l]);let o,a;for(;!(o=c.getReducedResult(a));){const l=yield this.read();a=c.reduceResponse(a,l)}return dt("apdu","<= "+o.toString("hex")),o})).catch(n=>{throw n&&n.message&&n.message.includes("write")?(this._emitDisconnect(n),new kn(n.message)):n})}),this.device=e,this.deviceModel=typeof e.productId=="number"?wt(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static request(){return X(this,void 0,void 0,function*(){const[e]=yield Ct();return K.open(e)})}static openConnected(){return X(this,void 0,void 0,function*(){const e=yield Xe();return e.length===0?null:K.open(e[0])})}static open(e){return X(this,void 0,void 0,function*(){yield e.open();const t=new K(e),s=n=>{e===n.device&&(de().removeEventListener("disconnect",s),t._emitDisconnect(new Kn))};return de().addEventListener("disconnect",s),t})}close(){return X(this,void 0,void 0,function*(){yield this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),yield this.device.close()})}setScrambleKey(){}}K.isSupported=ni;K.list=Xe;K.listen=r=>{let e=!1;ii().then(s=>{if(!s)r.error(new pt("Access denied to use Ledger device"));else if(!e){const n=typeof s.productId=="number"?wt(s.productId):void 0;r.next({type:"add",descriptor:s,deviceModel:n}),r.complete()}},s=>{r.error(new pt(s.message))});function t(){e=!0}return{unsubscribe:t}};export{K as T,Hn as a,$e as c,dt as l,Et as s};
